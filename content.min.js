let arrowRight=chrome.extension.getURL("right-arrow.svg"),arrowLeft=chrome.extension.getURL("left-arrow.svg");function mainFunc(){let a=window.location.href.match(/forum\?id=(.[^&^#]*)(&.*)?(#.*)?/);if(null==a);else{let b=a.at(1);fetch("https://api.openreview.net/notes?forum="+b,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include"}).then(a=>a.json()).then(a=>{parseData(a.notes.filter(a=>a.replyto===b&&a.invitation.toLowerCase().includes("review")).sort((a,b)=>b.number-a.number),a.notes.filter(a=>!!(a.replyto===b&&a.invitation.toLowerCase().includes("decision"))&&"content"in a&&"decision"in a.content))}).catch(a=>{console.error("Error: "+a)})}}function parseData(c,d){if(0===c.length)return;let b=document.createElement("div");b.className="sum-nav";let e=[],f=null,a="<table id='sum-tbl' style='display: table'><tr><td class='scd' colspan='2'>Quick\u{1F440}Look</td></tr>";c.forEach((b,g)=>{let c=null!=b.content.rating?b.content.rating:null!=b.content.recommendation?b.content.recommendation:null!=b.content.preliminary_rating?b.content.preliminary_rating:null;if(null==c);else{let d=null!=c.match(/(.*):/)?c.match(/(.*):/).at(1):null!=c.match(/(.*)-/)?c.match(/(.*)-/).at(1):null;f=null==f?d.match(/\d*/)[0].length===d.length:f,a+="<tr class='clk-tr' data-href='note_"+b.id+"'><td class='fst'>R"+(g+1)+":</td><td class='scd'>"+d+"</td></tr>",e.push(d)}}),!0===f&&(a+="<tr class='last'><td class='fst'>avg:</td><td class='scd'>"+(e.reduce((a,b)=>parseInt(a,10)+parseInt(b,10))/e.length).toFixed(2)+"</td></tr>"),d.length>0&&(a+="<tr class='last'><td colspan='2' class='scd'>"+d[0].content.decision+"</td></tr>"),a+="</table>",a+="<div class='nav-btn'><img id='nav-arrow' src="+arrowLeft+"></div>",b.insertAdjacentHTML("afterbegin",a),document.body.append(b),addClick()}function addClick(){document.querySelectorAll(".clk-tr").forEach((a,b)=>{a.addEventListener("click",()=>{let b=a.getAttribute("data-href"),c=document.getElementById(b).parentNode.offsetTop;window.scroll({top:c-50,behavior:"smooth"})})});let a=document.getElementById("nav-arrow");a.addEventListener("click",()=>{let b=document.getElementById("sum-tbl");b.getBoundingClientRect().left>=0?(a.src=arrowRight,b.style.transform="translateX(-200%)"):(a.src=arrowLeft,b.style.transform="translateX(0)")})}function clearSummary(){let a=document.getElementsByClassName("sum-nav");for(;a.length>0;)a[0].parentNode.removeChild(a[0])}chrome.runtime.onMessage.addListener(function(a,b,c){"TabUpdated"===a.message&&(clearSummary(),mainFunc())}),window.addEventListener("beforeunload",function(a){clearSummary()})
