let arrowRight=chrome.extension.getURL("right-arrow.svg"),arrowLeft=chrome.extension.getURL("left-arrow.svg");function mainFunc(){let t=window.location.href.match(/forum\?id=(.[^&^#]*)(&.*)?(#.*)?/);if(null==t);else{let e=t.at(1);fetch("https://api2.openreview.net/notes?forum="+e,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include"}).then((t=>t.json())).then((t=>{if(null===t||0===t.notes.length)return fetch("https://api.openreview.net/notes?forum="+e,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include"}).then((t=>t.json())).then((t=>{parseData(t.notes.filter((t=>t.replyto===e&&t.invitation.toLowerCase().includes("official_review"))).sort(((t,e)=>e.number-t.number)),t.notes.filter((t=>!(t.replyto!==e||!t.invitation.toLowerCase().includes("decision")||!("content"in t))&&"decision"in t.content)))})).catch((t=>{console.error("Error: "+t)}));parseData(t.notes.filter((t=>t.replyto===e&&t.invitations[0].toLowerCase().includes("official_review"))).sort(((t,e)=>e.number-t.number)),t.notes.filter((t=>!(t.replyto!==e||!t.invitations[0].toLowerCase().includes("decision")||!("content"in t))&&"decision"in t.content)))})).catch((t=>{console.error("Error: "+t)}))}}function parseData(t,e){if(0===t.length)return;let n=document.createElement("div");n.className="sum-nav";let o=[],r=null,a="<table id='sum-tbl' style='display: table'><tr><td class='scd' colspan='2'><a href='https://github.com/weigq/openview_quicklook'>QuickðŸ‘€Look</a></td></tr>";if(t.forEach(((t,e)=>{let n=null;if(null!=t.content.rating?n=t.content.rating.value?t.content.rating.value:t.content.rating:null!=t.content.recommendation?n=t.content.recommendation:null!=t.content.preliminary_rating?n=t.content.preliminary_rating:null!=t.content.overall_recommendation?n=t.content.overall_recommendation:null!=t.content.final_rating&&(n=t.content.final_rating),null==n);else{let l;l=null!=n.match(/(.*?):/)?n.match(/(.*?):/)[1]:null!=n.match(/(.*?)-/)?n.match(/(.*?)-/)[1]:null,null==r&&null!=l&&l.match(/\d*/)[0].length===l.length&&(r=!0),a+="<tr class='clk-tr' data-href="+t.id+"><td class='fst'>R"+(e+1)+":</td><td class='scd'>"+l+"</td></tr>",o.push(l)}})),!0===r){let t=o.reduce(((t,e)=>parseInt(t,10)+parseInt(e,10)))/o.length;a+="<tr class='last'><td class='fst'>avg:</td><td class='scd'>"+t.toFixed(2)+"</td></tr>"}e.length>0&&(a+="<tr class='last'><td colspan='2' class='scd'>"+e[0].content.decision+"</td></tr>"),a+="</table>",a+="<div class='nav-btn'><img id='nav-arrow' src="+arrowLeft+"></div>",n.insertAdjacentHTML("afterbegin",a),document.body.append(n),addClick()}const getOffsetTop=t=>{let e=0;for(;t;)e+=t.offsetTop,t=t.offsetParent;return e};function addClick(){document.querySelectorAll(".clk-tr").forEach(((t,e)=>{t.addEventListener("click",(()=>{let e,n=t.getAttribute("data-href");e=null!=document.querySelector("[data-id='"+n+"']")?document.querySelector("[data-id='"+n+"']"):document.getElementById("note_"+n);let o=getOffsetTop(e);window.scroll({top:o-75,behavior:"smooth"})}))}));let t=document.getElementById("nav-arrow");t.addEventListener("click",(()=>{let e=document.getElementById("sum-tbl");e.getBoundingClientRect().left>=0?(t.src=arrowRight,e.style.transform="translateX(-200%)"):(t.src=arrowLeft,e.style.transform="translateX(0)")}))}function clearSummary(){let t=document.getElementsByClassName("sum-nav");for(;t.length>0;)t[0].parentNode.removeChild(t[0])}chrome.runtime.onMessage.addListener((function(t,e,n){"TabUpdated"===t.message&&(clearSummary(),mainFunc())})),window.addEventListener("beforeunload",(function(t){clearSummary()}));
