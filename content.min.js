let arrowRight=chrome.runtime.getURL("right-arrow.svg"),arrowLeft=chrome.runtime.getURL("left-arrow.svg");function mainFunc(){let e=window.location.href.match(/forum\?id=(.[^&^#]*)(&.*)?(#.*)?/);if(null==e);else{let t=e.at(1);fetch("https://api2.openreview.net/notes?forum="+t,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include"}).then((e=>e.json())).then((e=>{if(null===e||0===e.notes.length)return fetch("https://api.openreview.net/notes?forum="+t,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include"}).then((e=>e.json())).then((e=>{parseData(e.notes.filter((e=>e.replyto===t&&e.invitation.toLowerCase().includes("official_review"))).sort(((e,t)=>t.number-e.number)),e.notes.filter((e=>!(e.replyto!==t||!e.invitation.toLowerCase().includes("decision")||!("content"in e))&&"decision"in e.content)))})).catch((e=>{console.error("Error: "+e)}));parseData(e.notes.filter((e=>e.replyto===t&&e.invitations[0].toLowerCase().includes("official_review"))).sort(((e,t)=>t.number-e.number)),e.notes.filter((e=>!(e.replyto!==t||!e.invitations[0].toLowerCase().includes("decision")||!("content"in e))&&"decision"in e.content)))})).catch((e=>{console.error("Error: "+e)}))}}function parseData(e,t){if(0===e.length)return;let n=document.createElement("div");n.className="sum-nav";let o=[],r=null,a="<table id='sum-tbl' style='display: table'><tr><td class='scd' colspan='2'><a href='https://github.com/weigq/openview_quicklook'>QuickðŸ‘€Look</a></td></tr>";if(e.forEach(((e,t)=>{let n=null;if(null!=e.content.rating?n=e.content.rating.value?e.content.rating.value:e.content.rating:null!=e.content.recommendation?n=e.content.recommendation:null!=e.content.preliminary_rating?n=e.content.preliminary_rating:null!=e.content.overall_recommendation?n=e.content.overall_recommendation.value?e.content.overall_recommendation.value:e.content.overall_recommendation:null!=e.content.final_rating&&(n=e.content.final_rating),null==n);else{let l;l="number"==typeof n?n.toString():null!=n.match(/(.*?):/)?n.match(/(.*?):/)[1]:null!=n.match(/(.*?)-/)?n.match(/(.*?)-/)[1]:null,null==r&&null!=l&&l.match(/\d*/)[0].length===l.length&&(r=!0),a+="<tr class='clk-tr' data-href="+e.id+"><td class='fst'>R"+(t+1)+":</td><td class='scd'>"+l+"</td></tr>",o.push(l)}})),!0===r){let e=o.reduce(((e,t)=>parseInt(e,10)+parseInt(t,10)))/o.length;a+="<tr class='last'><td class='fst'>avg:</td><td class='scd'>"+e.toFixed(2)+"</td></tr>"}t.length>0&&(decision_value=t[0].content.decision.value?t[0].content.decision.value:t[0].content.decision,a+="<tr class='last'><td colspan='2' class='scd'>"+decision_value+"</td></tr>"),a+="</table>",a+="<div class='nav-btn'><img id='nav-arrow' src="+arrowLeft+"></div>",n.insertAdjacentHTML("afterbegin",a),document.body.append(n),addClick()}const getOffsetTop=e=>{let t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t};function addClick(){document.querySelectorAll(".clk-tr").forEach(((e,t)=>{e.addEventListener("click",(()=>{let t,n=e.getAttribute("data-href");t=null!=document.querySelector("[data-id='"+n+"']")?document.querySelector("[data-id='"+n+"']"):document.getElementById("note_"+n);let o=getOffsetTop(t);window.scroll({top:o-75,behavior:"smooth"})}))}));let e=document.getElementById("nav-arrow");e.addEventListener("click",(()=>{let t=document.getElementById("sum-tbl");t.getBoundingClientRect().left>=0?(e.src=arrowRight,t.style.transform="translateX(-200%)"):(e.src=arrowLeft,t.style.transform="translateX(0)")}))}function clearSummary(){let e=document.getElementsByClassName("sum-nav");for(;e.length>0;)e[0].parentNode.removeChild(e[0])}chrome.runtime.onMessage.addListener((function(e,t,n){"TabUpdated"===e.message&&(clearSummary(),mainFunc())})),window.addEventListener("beforeunload",(function(e){clearSummary()}));
