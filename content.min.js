let arrowRight=chrome.extension.getURL("right-arrow.svg"),arrowLeft=chrome.extension.getURL("left-arrow.svg");function mainFunc(){let t=window.location.href.match(/forum\?id=(.[^&^#]*)(&.*)?(#.*)?/);if(null==t);else{let e=t.at(1);fetch("https://api.openreview.net/notes?forum="+e,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include"}).then(t=>t.json()).then(t=>{parseData(t.notes.filter(t=>t.replyto===e&&t.invitation.toLowerCase().includes("review")).sort((t,e)=>e.number-t.number),t.notes.filter(t=>!!(t.replyto===e&&t.invitation.toLowerCase().includes("decision"))&&"content"in t&&"decision"in t.content))}).catch(t=>{console.error("Error: "+t)})}}function parseData(t,e){if(0===t.length)return;let n=document.createElement("div");n.className="sum-nav";let a=[],l=null,r="<table id='sum-tbl' style='display: table'><tr><td class='scd' colspan='2'><a href='https://github.com/weigq/openview_quicklook'>Quick\uD83D\uDC40Look</a></td></tr>";t.forEach((t,e)=>{let n=null!=t.content.rating?t.content.rating:null!=t.content.recommendation?t.content.recommendation:null!=t.content.final_rating?t.content.final_rating:null!=t.content.preliminary_rating?t.content.preliminary_rating:null!=t.content.overall_recommendation?t.content.overall_recommendation:null;if(null==n);else{let o=null!=n.match(/(.*):/)?n.match(/(.*):/).at(1):null!=n.match(/(.*)-/)?n.match(/(.*)-/).at(1):n;l=null==l?o.match(/\d*/)[0].length===o.length:l,r+="<tr class='clk-tr' data-href='note_"+t.id+"'><td class='fst'>R"+(e+1)+":</td><td class='scd'>"+o+"</td></tr>",a.push(o)}}),!0===l&&(r+="<tr class='last'><td class='fst'>avg:</td><td class='scd'>"+(a.reduce((t,e)=>parseInt(t,10)+parseInt(e,10))/a.length).toFixed(2)+"</td></tr>"),e.length>0&&(r+="<tr class='last'><td colspan='2' class='scd'>"+e[0].content.decision+"</td></tr>"),r+="</table>",r+="<div class='nav-btn'><img id='nav-arrow' src="+arrowLeft+"></div>",n.insertAdjacentHTML("afterbegin",r),document.body.append(n),addClick()}function addClick(){document.querySelectorAll(".clk-tr").forEach((t,e)=>{t.addEventListener("click",()=>{let e=t.getAttribute("data-href"),n=document.getElementById(e).parentNode.offsetTop;window.scroll({top:n-50,behavior:"smooth"})})});let t=document.getElementById("nav-arrow");t.addEventListener("click",()=>{let e=document.getElementById("sum-tbl");e.getBoundingClientRect().left>=0?(t.src=arrowRight,e.style.transform="translateX(-200%)"):(t.src=arrowLeft,e.style.transform="translateX(0)")})}function clearSummary(){let t=document.getElementsByClassName("sum-nav");for(;t.length>0;)t[0].parentNode.removeChild(t[0])}chrome.runtime.onMessage.addListener(function(t,e,n){"TabUpdated"===t.message&&(clearSummary(),mainFunc())}),window.addEventListener("beforeunload",function(t){clearSummary()});
